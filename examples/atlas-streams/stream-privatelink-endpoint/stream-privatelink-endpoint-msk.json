{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "This template creates a Stream Processing Private Link Endpoint for Amazon MSK (Managed Streaming for Kafka). This enables secure, private connectivity between Atlas Stream Processing and Amazon MSK over AWS PrivateLink.",
  "Parameters": {
    "Profile": {
      "Type": "String",
      "Default": "default",
      "Description": "Secret Manager Profile that contains the Atlas Programmatic keys"
    },
    "ProjectId": {
      "Type": "String",
      "Description": "Unique 24-hexadecimal digit string that identifies your Atlas project"
    },
    "MskClusterArn": {
      "Type": "String",
      "Description": "Amazon Resource Name (ARN) of the MSK cluster (e.g., arn:aws:kafka:us-east-1:123456789012:cluster/my-cluster/uuid)"
    }
  },
  "Resources": {
    "StreamPrivatelinkEndpoint": {
      "Type": "MongoDB::Atlas::StreamPrivatelinkEndpoint",
      "Properties": {
        "Profile": {
          "Ref": "Profile"
        },
        "ProjectId": {
          "Ref": "ProjectId"
        },
        "ProviderName": "AWS",
        "Vendor": "MSK",
        "Arn": {
          "Ref": "MskClusterArn"
        }
      }
    }
  },
  "Outputs": {
    "PrivateLinkEndpointId": {
      "Description": "The ID of the Private Link connection",
      "Value": {
        "Ref": "StreamPrivatelinkEndpoint"
      }
    },
    "State": {
      "Description": "Status of the connection",
      "Value": {
        "Fn::GetAtt": ["StreamPrivatelinkEndpoint", "State"]
      }
    },
    "ProviderAccountId": {
      "Description": "AWS account ID of the Atlas Stream Processing infrastructure",
      "Value": {
        "Fn::GetAtt": ["StreamPrivatelinkEndpoint", "ProviderAccountId"]
      }
    }
  }
}
