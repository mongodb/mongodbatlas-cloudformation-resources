{
  "AWSTemplateFormatVersion" : "2010-09-09",
  "Description" : "This template creates a Network Container on the MongoDB Atlas API, this will be billed to your Atlas account.",
  "Parameters" : {
    "ProjectName" : {
      "Type" : "String"
    },
    "RegionName" : {
      "Type" : "String",
      "Default": "US_EAST_1"
    },
    "AtlasCidrBlock" : {
      "Type" : "String",
      "Default": "10.8.2.0/24"
    }
  },
  "Mappings" : {},
  "Resources" : {
    "Project": {
      "Type": "MongoDB::Atlas::Project",
      "Properties": {
        "Name": { "Ref" : "ProjectName" },
        "OrgId": "{{resolve:secretsmanager:mongodb/atlas/secrets:SecretString:AtlasMongoDBOrgID}}"
      }
    },
    "NetworkContainer": {
      "Type": "MongoDB::Atlas::NetworkContainer",
      "Properties": {
        "AtlasCidrBlock": {"Ref": "AtlasCidrBlock"},
        "RegionName": { "Ref" : "RegionName" },
        "ProjectId": { "Fn::GetAtt": [
          "Project",
          "Id"
        ] }
      }
    }
  },
  "Outputs" : {
    "ProjectId": {
      "Description": "Id of the project",
      "Value" : { "Fn::GetAtt": [
        "Project",
        "Id"
      ] }
    },
    "ContainerId": {
      "Description": "Id of the network container",
      "Value" : { "Fn::GetAtt": [
        "NetworkContainer",
        "Id"
      ] }
    }
  }
}
